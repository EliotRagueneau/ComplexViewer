<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ComplexViewer Demo</title>
    <meta content="ComplexViewer Demo" name="ComplexViewer Demo">
    <meta content="initial-scale=1, maximum-scale=1" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <!-- css -->
    <link href="./demo/css/reset.css" rel="stylesheet" type='text/css'>
    <link href="./demo/css/style.css" rel="stylesheet" type='text/css'>
    <link href="./demo/css/demo.css" rel="stylesheet" type='text/css'>
    <link href="./demo/css/XLV.css" rel="stylesheet" type='text/css'/>
    <!--libraries-->
    <script src="./dist/complexviewer.js" type="text/javascript"></script>
    <script src="./node_modules/d3/d3.js" type="text/javascript"></script>
    <script src="./demo/rgbcolor.js" type="text/javascript"></script>
    <script src="./demo/legend.js" type="text/javascript"></script>
    <!-- example data info -->
    <script src="./demo/data/miJson/index.js" type="text/javascript"></script>
</head>

<body>
<!-- Main -->
<div id="main">

    <div class="page-header">
        <i class="fa fa-github" onclick="window.location = 'https://github.com/MICommunity/ComplexViewer';"
           style="margin-right:5px;" title="Go to GitHub project"></i>
        <a href="https://doi.org/10.1093/bioinformatics/btx497" target="_blank"><h1>ComplexViewer: dev. version</h1></a>
    </div>

    <div id="centre">

        <div id="detailsDiv">
            <span>Choose Example:</span>
            <label for="dataSets">Example:</label><select class="noShrink" id="dataSets"
                                                  onChange="/*document.getElementById('chkexpansion').checked = true;*/loadData();"></select>
            <br>
            <div id="complexDetails"></div>
        </div>

        <div id="middleDiv">
            <div id="innerMiddleDiv">


                <div id="networkDiv"></div>
                <div id="legend">

                    <table>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="Bioactive Entity" src="./demo/svgForKey/molSet.svg">
                                </div>
                            </td>
                            <td>Molecule Set</td>
                        </tr>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="Bioactive Entity" src="./demo/svgForKey/smallMol.svg">
                                </div>
                            </td>
                            <td>Bioactive Entity</td>
                        </tr>

                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="Gene" src="./demo/svgForKey/gene.svg">
                                </div>
                            </td>
                            <td>Gene</td>
                        </tr>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="DNA" src="./demo/svgForKey/DNA.svg">
                                </div>
                            </td>
                            <td>DNA</td>
                        </tr>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="RNA" src="./demo/svgForKey/RNA.svg">
                                </div>
                            </td>
                            <td>RNA</td>
                        </tr>
                        <tr style="border: 1px grey;">
                            <td>
                                <div style="float:right">
                                    <img alt="Protein" src="./demo/svgForKey/proteinBlob.svg">
                                </div>
                                <div style="float:right">
                                    <img alt="Protein" src="./demo/svgForKey/proteinBar.svg">
                                </div>
                            </td>
                            <td>Protein - click to toggle between circle and bar</td>
                        </tr>
                    </table>

                    <div class="controls" style="height:46px;">Proteins:
                        <button class="btn btn-1 btn-1a" onclick="xlv.expandAll();">Expand</button>
                        <button class="btn btn-1 btn-1a" onclick="xlv.collapseAll();">Collapse</button>
                    </div>


                    <div id="colours"></div>
                </div><!-- legend -->


            </div> <!-- innerMiddleDiv -->


            <div>
                <div class="controls">
                    <label for="annotationsSelect">Annotations:</label><select class="btn btn-1 btn-1a" id="annotationsSelect" onChange="changeAnnotations();">
                        <option selected='selected'>MI features</option>
                        <option>UniprotKB</option>
                        <option>SuperFamily</option>
                        <option>None</option>
                        <option>Interactor</option>
                    </select>
                    <!-- <label>&nbsp;&nbsp;Expand Stoich.
                    <input checked onclick="loadData()" id="chkexpansion" value="expansion" type="checkbox">
                    </label> -->
                    &nbsp;&nbsp;
                    <button class="btn btn-1 btn-1a" onclick="xlv.autoLayout();" style="display:inline">Layout</button>
                    <button class="btn btn-1 btn-1a" onclick="exportSVG();" style="display:inline">Export Graphic
                    </button>
                </div>


            </div> <!-- bottom bar -->

        </div> <!-- middleDiv -->

    </div> <!-- centreDiv -->

    <div class="logoBar">
        <a class="logo" href="http://rappsilberlab.org/" target="_blank"><img
                alt="" src="./demo/images/RapLabTextLogoSmall.png"></a>
        <a class="logo" href="http://www.ed.ac.uk/" target="_blank"><img alt="" src="./demo/images/eduni.jpeg"></a>
        <a class="logo" href="http://www.wcb.ed.ac.uk/" target="_blank"><img alt="" src="./demo/images/WTCCB.png"></a>
        <a class="logo" href="http://www.ebi.ac.uk/" target="_blank"><img alt="" src="./demo/images/ebiLogo2.jpeg"></a>
        <a class="logo" href="http://intermine.org/" target="_blank"><img alt="" src="./demo/images/intermine.png"></a>
        <a class="logo" href="https://www.cam.ac.uk/" target="_blank"><img alt=""
                                                                           src="./demo/images/cambridge-blue.png"></a>
        <!--
                    </div>
        -->
    </div>

</div><!-- MAIN -->

<script type="text/javascript">
    //<![CDATA[

    var targetDiv = document.getElementById('networkDiv');
    xlv = new xiNET(targetDiv);
    xlv.svgElement.setAttribute("style", "display: -webkit-box;display: -moz-box;display: -ms-flexbox; display: -webkit-flex;display: flex;flex-grow:1;");

    var legend = d3.select("svg").append("g");
    xlv.legendCallbacks.push(function (colourAssignment) {
        legend.selectAll("*").remove();
        var table = "<table>";
        var coloursKeyDiv = document.getElementById('colours');
        if (colourAssignment) {

            var complexColourScheme = xlv.getComplexColours();
            var ccDomain = complexColourScheme.domain();
            var ccRange = complexColourScheme.range();
            table += "<tr style='height:10px;'></tr>";
            for (var i = 0; i < ccDomain.length; i++) {
                //make transparent version of colour
                var temp = new RGBColor(ccRange[i % 6]);
                //var trans = "rgba(" +temp.r+","+temp.g+","+temp.b+ ", 0.6)";
                table += "<tr><td style='width:75px;margin:10px;background:"
                    + ccRange[i % 6] + ";border:1px solid "
                    + ccRange[i % 6] + ";'></td><td>"
                    + ccDomain[i] + "</td></tr>";
                console.log(i + " " + ccDomain[i] + " " + ccRange[i]);
            }
            table = table += "</table>";
            table = table += "<table>";

            var domain = colourAssignment.domain();
            //~ //console.log("Domain:"+domain);
            var range = colourAssignment.range();
            //~ //console.log("Range:"+range);
            table += "<tr style='height:10px;'></tr>";
            for (var i = 0; i < domain.length; i++) {
                //make transparent version of colour
                var temp = new RGBColor(range[i % 20]);
                var trans = "rgba(" + temp.r + "," + temp.g + "," + temp.b + ", 0.6)";
                table += "<tr><td style='width:75px;margin:10px;background:"
                    + trans + ";border:1px solid "
                    + range[i % 20] + ";'></td><td>"
                    + domain[i] + "</td></tr>";
                //~ //console.log(i + " "+ domain[i] + " " + range[i]);
            }

            table = table += "</table>";
            coloursKeyDiv.innerHTML = table;


            //~ //d3 svg legend
            //~ verticalLegend = d3.svg.legend().labelFormat("none").cellPadding(5).orientation("vertical").units(xlv.annotationChoice).cellWidth(25).cellHeight(18).inputScale(colourAssignment);
            //~ legend.attr("transform", "translate(20,40)").attr("class", "legend").call(verticalLegend);
        }

    });

    for (var i = 0; i < exampleIndex.length; i++) {
        var example = exampleIndex[i];
        var dataSetsSelect = document.getElementById('dataSets');
        var opt = document.createElement('option');
        opt.value = "./demo/data/miJson/" + example.ac + ".json";
        opt.innerHTML = example.name;
        dataSetsSelect.appendChild(opt);
    }

    loadData();
    changeAnnotations();

    function loadData() {
        xlv.clear();
        var dataSetsSelect = document.getElementById('dataSets');

        var example = exampleIndex[dataSetsSelect.selectedIndex];

        var complexDetailsSel = d3.select('#complexDetails');

        complexDetailsSel.selectAll("*").remove("*");

        complexDetailsSel.append("a")
            .attr("href", example.url)
            .attr("target", "_blank")
            .html("<b>" + example.ac + "</b>");


        // if (example.disableStoichExpand) {
        //     d3.select("#chkexpansion").attr("disabled", "disabled");
        //     document.getElementById("chkexpansion").checked = false;
        // } else {
        //     d3.select("#chkexpansion").attr("disabled", null);
        //     //~ document.getElementById("chkexpansion").checked = true;
        // }
        //var matrixExpansion = document.getElementById("chkexpansion").checked;

        var path = dataSetsSelect.options[dataSetsSelect.selectedIndex].value;
        d3.json(path, function (data) {
            xlv.readMIJSON(data);//, matrixExpansion);
        });
    }

    function changeAnnotations() {
        var annotationSelect = document.getElementById('annotationsSelect');
        xlv.setAnnotations(annotationSelect.options[annotationSelect.selectedIndex].value);
    }

    function exportSVG() {
        var xml = xlv.getSVG();
        xmlAsUrl = 'data:image/svg;filename=xiNET-output.svg,';
        xmlAsUrl += encodeURIComponent(xml);
        alert("Downloading as SVG. You may need to change the file extension to '.svg' before opening.");
        var win = window.open(xmlAsUrl, 'xiNET-output.svg');
    }

    //]]>
</script>

</body>
</html>
