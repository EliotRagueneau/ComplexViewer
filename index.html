<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ComplexViewer Demo</title>
    <meta content="ComplexViewer Demo" name="ComplexViewer Demo">
    <meta content="initial-scale=1, maximum-scale=1" name="viewport">
    <!-- css -->
    <link href="./css/reset.css" rel="stylesheet" type='text/css'>
    <link href="./css/style.css" rel="stylesheet" type='text/css'>
    <link href="./css/demo.css" rel="stylesheet" type='text/css'>
    <!--libraries-->
    <script src="./dist/complexviewer.js" type="text/javascript"></script>
    <!-- example data info -->
    <script src="./data/index.js" type="text/javascript"></script>
</head>
<body>
<!-- Main -->
<div id="main">

    <div class="page-header">
        <i class="fa fa-github" onclick="window.location = 'https://github.com/MICommunity/ComplexViewer';"
           style="margin-right:5px;" title="GitHub project"></i>
        <h1><a href="https://doi.org/10.1093/bioinformatics/btx497" target="_blank"
               title="Publication">ComplexViewer</a></h1>
        <div class="examples-dropdown">
            <label for="dataSets">Example:</label>
            <select class="noShrink" id="dataSets"
                    onChange="/*document.getElementById('chkexpansion').checked = true;*/loadData();"></select>
            <br>
        </div>
    </div>

    <div id="centre">

        <!--        <div id="detailsDiv"></div>-->

        <div id="middleDiv">
            <div id="innerMiddleDiv">
                <div id="networkDiv"></div>
                <div id="symbolKeyDiv">
                    <table>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="Bioactive Entity" src="./src/imgs/key-svg/molecule-set.svg">
                                </div>
                            </td>
                            <td>Molecule Set</td>
                        </tr>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="Bioactive Entity" src="./src/imgs/key-svg/small-molecule.svg">
                                </div>
                            </td>
                            <td>Bioactive Entity</td>
                        </tr>

                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="Gene" src="./src/imgs/key-svg/gene.svg">
                                </div>
                            </td>
                            <td>Gene</td>
                        </tr>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="DNA" src="./src/imgs/key-svg/dna.svg">
                                </div>
                            </td>
                            <td>DNA</td>
                        </tr>
                        <tr>
                            <td>
                                <div style="float:right">
                                    <img alt="RNA" src="./src/imgs/key-svg/rna.svg">
                                </div>
                            </td>
                            <td>RNA</td>
                        </tr>
                        <tr style="border: 1px grey;">
                            <td>
                                <div style="float:right">
                                    <img alt="Protein" src="./src/imgs/key-svg/protein-circle.svg">
                                </div>
                                <div style="float:right">
                                    <img alt="Protein" src="./src/imgs/key-svg/protein-bar.svg">
                                </div>
                            </td>
                            <td>Protein - click to toggle between circle and bar</td>
                        </tr>
                    </table>
                    <div class="controls" style="height:46px;">Proteins:
                        <button class="btn btn-1 btn-1a" onclick="cv.expandAll();">Expand</button>
                        <button class="btn btn-1 btn-1a" onclick="cv.collapseAll();">Collapse</button>
                    </div>
                    <div id="colors"></div>

                </div><!-- legend -->

            </div> <!-- innerMiddleDiv -->

            <div>
                <div class="controls">
                    <div>
                        Annotations:

                        <input type="checkbox" id="mifeatures" name="mifeatures" value="MIFEATURES"
                               onchange="setAnnotations(this);">
                        <label for="mifeatures"> MI Features</label>
                        <input type="checkbox" id="uniprotkb" name="uniprotkb" value="UNIPROTKB"
                               onchange="setAnnotations(this);">
                        <label for="uniprotkb"> UniprotKB Domains</label>
                        <input type="checkbox" id="superfamily" name="superfamily" value="SUPERFAMILY"
                               onchange="setAnnotations(this);">
                        <label for="superfamily"> Superfamily</label>
                        <input type="checkbox" id="interactor" name="interactor" value="INTERACTOR"
                               onchange="setAnnotations(this);">
                        <label for="interactor"> Interactor</label>
                    </div>
                    <div class="other-controls">
                        <!-- <label>&nbsp;&nbsp;Expand Stoich.
                        <input checked onclick="loadData()" id="chkexpansion" value="expansion" type="checkbox">
                        </label> -->
                        <button class="btn btn-1 btn-1a" onclick="cv.autoLayout();" style="display:inline">Layout
                        </button>
                        <button class="btn btn-1 btn-1a" onclick="exportSVG();" style="display:inline">Export Graphic
                        </button>
                    </div>

                </div>

            </div> <!-- bottom bar -->

        </div> <!-- middleDiv -->

    </div> <!-- centreDiv -->

    <div class="logoBar">
        <a class="logo" href="http://rappsilberlab.org/" target="_blank"><img src="images/logos/rappsilber-logo.png"
                                                                              alt="Rappsilber Laboratory"></a>
        <a class="logo" href="http://www.ed.ac.uk/" target="_blank"><img src="./images/logos/eduni.jpeg"
                                                                         alt="Edinburgh University"></a>
        <a class="logo" href="http://www.wcb.ed.ac.uk/" target="_blank"><img src="images/logos/wtccb.png"
                                                                             alt="Wellcome Trust Centre for Cell Biology"></a>
        <a class="logo" href="http://www.ebi.ac.uk/" target="_blank"><img src="images/logos/ebi-logo.jpeg"
                                                                          alt="European Bioinformatics Institute"></a>
        <a class="logo" href="http://intermine.org/" target="_blank"><img src="./images/logos/intermine.png"
                                                                          alt="Intermine"></a>
        <a class="logo" href="https://www.cam.ac.uk/" target="_blank"><img src="./images/logos/cambridge-blue.png"
                                                                           alt="Cambridge University"></a>
    </div>

</div><!-- MAIN -->

<script type="text/javascript">
    //<![CDATA[

    const networkTargetDiv = document.getElementById("networkDiv");
    cv = new complexviewer.App(networkTargetDiv);
    cv.addColorSchemeKey(document.getElementById("colors"));
    //todo - er, use css
    cv.svgElement.setAttribute("style", "display: -webkit-box;display: -moz-box;display: -ms-flexbox; display: -webkit-flex;display: flex;flex-grow:1;");

    for (let example of exampleIndex) {
        const dataSetsSelect = document.getElementById("dataSets");
        const opt = document.createElement("option");
        opt.value = "./data/" + example.ac + ".json";
        opt.innerHTML = example.name;
        dataSetsSelect.appendChild(opt);
    }

    loadData();

    function loadData() {
        cv.clear();
        const dataSetsSelect = document.getElementById("dataSets");
        const path = dataSetsSelect.options[dataSetsSelect.selectedIndex].value;
        d3.json(path, function (data) {
            cv.readMIJSON(data);//, matrixExpansion);
            resetAnnotations();
        });
    }

    function resetAnnotations() {
        let checkbox = document.getElementById("mifeatures");
        cv.showAnnotations(checkbox.value, checkbox.checked);
        checkbox = document.getElementById("uniprotkb");
        cv.showAnnotations(checkbox.value, checkbox.checked);
        checkbox = document.getElementById("superfamily");
        cv.showAnnotations(checkbox.value, checkbox.checked);
        checkbox = document.getElementById("interactor");
        cv.showAnnotations(checkbox.value, checkbox.checked);
    }

    function setAnnotations(checkbox){
        cv.showAnnotations(checkbox.value, checkbox.checked);
    }

    function exportSVG() {
        // todo
        const xml = cv.getSVG();
        let xmlAsUrl = "data:image/svg;filename=xiNET-output.svg,";
        xmlAsUrl += encodeURIComponent(xml);
        alert("Downloading as SVG. You may need to change the file extension to '.svg' before opening.");
        window.open(xmlAsUrl, "xiNET-output.svg");
    }

    //]]>
</script>

</body>
</html>
